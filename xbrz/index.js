import pool from "../utils/pool";
var AFunction = Object.getPrototypeOf( function(){}).constructor;
window.xbrz_process_function = new AFunction(`var e=function(e,t){return new Promise((function(s,r){"use strict";var a=16711680,i=65280;function n(e,t,s,r,a){return e&((a&e)*t+(r&e)*(s-t))/s}function l(e,t,s,r){var l=s.get(),h=n(a,e,t,l,r)|n(i,e,t,l,r)|n(255,e,t,l,r);s.set(4278190080|h)}class h{constructor(){this.scale=2}scale(){return this.scale}blendLineShallow(e,t){l(1,4,t.ref(this.scale-1,0),e),l(3,4,t.ref(this.scale-1,1),e)}blendLineSteep(e,t){l(1,4,t.ref(0,this.scale-1),e),l(3,4,t.ref(1,this.scale-1),e)}blendLineSteepAndShallow(e,t){l(1,4,t.ref(1,0),e),l(1,4,t.ref(0,1),e),l(5,6,t.ref(1,1),e)}blendLineDiagonal(e,t){l(1,2,t.ref(1,1),e)}blendCorner(e,t){l(21,100,t.ref(1,1),e)}}class f extends h{constructor(){super(),this.scale=3}blendLineShallow(e,t){super.blendLineShallow(e,t),l(1,4,t.ref(this.scale-2,2),e),t.ref(this.scale-1,2).set(e)}blendLineSteep(e,t){super.blendLineSteep(e,t),l(1,4,t.ref(2,this.scale-2),e),t.ref(2,this.scale-1).set(e)}blendLineSteepAndShallow(e,t){l(1,4,t.ref(2,0),e),l(1,4,t.ref(0,2),e),l(3,4,t.ref(2,1),e),l(3,4,t.ref(1,2),e),t.ref(2,2).set(e)}blendLineDiagonal(e,t){l(1,8,t.ref(1,2),e),l(1,8,t.ref(2,1),e),l(7,8,t.ref(2,2),e)}blendCorner(e,t){l(45,100,t.ref(2,2),e)}}class c extends f{constructor(){super(),this.scale=4}blendLineShallow(e,t){super.blendLineShallow(e,t),l(3,4,t.ref(this.scale-2,3),e),t.ref(this.scale-1,3).set(e)}blendLineSteep(e,t){super.blendLineSteep(e,t),l(3,4,t.ref(3,this.scale-2),e),t.ref(3,this.scale-1).set(e)}blendLineSteepAndShallow(e,t){l(3,4,t.ref(3,1),e),l(3,4,t.ref(1,3),e),l(1,4,t.ref(3,0),e),l(1,4,t.ref(0,3),e),l(1,3,t.ref(2,2),e),t.ref(3,3).set(e),t.ref(3,2).set(e),t.ref(2,3).set(e)}blendLineDiagonal(e,t){l(1,2,t.ref(this.scale-1,this.scale/2),e),l(1,2,t.ref(this.scale-2,this.scale/2+1),e),t.ref(this.scale-1,this.scale-1).set(e)}blendCorner(e,t){l(68,100,t.ref(3,3),e),l(9,100,t.ref(3,2),e),l(9,100,t.ref(2,3),e)}}class o extends c{constructor(){super(),this.scale=5}blendLineShallow(e,t){super.blendLineShallow(e,t),l(1,4,t.ref(this.scale-3,4),e),t.ref(this.scale-1,4).set(e),t.ref(this.scale-2,4).set(e)}blendLineSteep(e,t){super.blendLineSteep(e,t),l(1,4,t.ref(4,this.scale-3),e),l(3,4,t.ref(3,this.scale-2),e),t.ref(4,this.scale-1).set(e),t.ref(4,this.scale-2).set(e)}blendLineSteepAndShallow(e,t){l(1,4,t.ref(0,this.scale-1),e),l(1,4,t.ref(2,this.scale-2),e),l(3,4,t.ref(1,this.scale-1),e),l(1,4,t.ref(this.scale-1,0),e),l(1,4,t.ref(this.scale-2,2),e),l(3,4,t.ref(this.scale-1,1),e),l(2,3,t.ref(3,3),e),t.ref(2,this.scale-1).set(e),t.ref(3,this.scale-1).set(e),t.ref(4,this.scale-1).set(e),t.ref(this.scale-1,2).set(e),t.ref(this.scale-1,3).set(e)}blendLineDiagonal(e,t){l(1,8,t.ref(this.scale-1,this.scale/2),e),l(1,8,t.ref(this.scale-2,this.scale/2+1),e),l(1,8,t.ref(this.scale-3,this.scale/2+2),e),l(7,8,t.ref(4,3),e),l(7,8,t.ref(3,4),e),t.ref(4,4).set(e)}blendCorner(e,t){l(86,100,t.ref(4,4),e),l(23,100,t.ref(4,3),e),l(23,100,t.ref(3,4),e)}}class u extends o{constructor(){super(),this.scale=6}blendLineShallow(e,t){super.blendLineShallow(e,t),l(3,4,t.ref(this.scale-3,5),e),t.ref(this.scale-1,5).set(e),t.ref(this.scale-2,5).set(e)}blendLineSteep(e,t){super.blendLineSteep(e,t),l(3,4,t.ref(5,this.scale-3),e),t.ref(5,this.scale-1).set(e),t.ref(5,this.scale-2).set(e)}blendLineSteepAndShallow(e,t){l(1,4,t.ref(0,this.scale-1),e),l(1,4,t.ref(2,this.scale-2),e),l(3,4,t.ref(1,this.scale-1),e),l(3,4,t.ref(3,this.scale-2),e),l(1,4,t.ref(this.scale-1,0),e),l(1,4,t.ref(this.scale-2,2),e),l(3,4,t.ref(this.scale-1,1),e),l(3,4,t.ref(this.scale-2,3),e),t.ref(2,this.scale-1).set(e),t.ref(3,this.scale-1).set(e),t.ref(4,this.scale-1).set(e),t.ref(5,this.scale-1).set(e),t.ref(4,this.scale-2).set(e),t.ref(5,this.scale-2).set(e),t.ref(this.scale-1,2).set(e),t.ref(this.scale-1,3).set(e)}blendLineDiagonal(e,t){l(1,2,t.ref(this.scale-1,this.scale/2),e),l(1,2,t.ref(this.scale-2,this.scale/2+1),e),l(1,2,t.ref(this.scale-3,this.scale/2+2),e),t.ref(this.scale-2,this.scale-1).set(e),t.ref(this.scale-1,this.scale-1).set(e),t.ref(this.scale-1,this.scale-2).set(e)}blendCorner(e,t){l(97,100,t.ref(5,5),e),l(42,100,t.ref(4,5),e),l(42,100,t.ref(5,4),e),l(6,100,t.ref(5,3),e),l(6,100,t.ref(3,5),e)}}class d{constructor(e){this.arr=e,this.ptr=0}position(e){this.ptr=e}get(){return this.arr[this.ptr]}set(e){this.arr[this.ptr]=e}}class p{constructor(e,t,s){this.out=new d(t),this.n=144*(e-2),this.outWidth=s,this.outi=0,this.nr=0}move(e,t){this.nr=this.n+36*e,this.outi=t}ref(e,t){e=parseInt(e),t=parseInt(t);var s=T[this.nr+6*e+t];return this.out.position(this.outi+s.J+s.I*this.outWidth),this.out}}var b=function(){for(var e=[],t=[[0,1,2,3,4,5,6,7,8],[6,3,0,7,4,1,8,5,2],[8,7,6,5,4,3,2,1,0],[2,5,8,1,4,7,0,3,6]],s=0;s<4;s++)for(var r=0;r<9;r++)e[(r<<2)+s]=t[s][r];return e}(),g=0,v=1,L=2,m=new class{constructor(){this.f=0,this.g=0,this.j=0,this.k=0}reset(){this.f=0,this.g=0,this.j=0,this.k=0}};function w(e){return e*e}function S(e,t,s,r,a){for(var i=0;i<a;++i,t+=s)for(var n=0;n<a;++n)e[t+n]=r}function k(e,t,s){return e===t?0:function(e,t,s){var r=(e&a)-(t&a)>>16,n=(255&e)-(255&t),l=.2126*r+.7152*((e&i)-(t&i)>>8)+.0722*n,h=.5389092476826902*(n-l),f=.63500127000254*(r-l);return w(s*l)+w(h)+w(f)}(e,t,s)}var j=3.6,M=1,x=2.2;function A(e,t){return k(e&=4294967295,t&=4294967295,M)}var R=w(30);function B(e,t){return k(e,t,M)<R}function C(e,t){return k(e,t,M)}function I(e,t,s,r){var a=0,i=0;if(0===e)a=t,i=s;else{var n=I(e-1,t,s,r);a=r-1-n.J,i=n.I}return{I:a,J:i}}var T=function(){for(var e=[],t=2;t<7;t++)for(var s=0;s<4;s++)for(var r=144*(t-2)+36*s,a=0;a<6;a++)for(var i=0;i<6;i++)e[r+6*a+i]=I(s,a,i,t);return e}();function D(e){if(m.reset(),!(e.f===e.g&&e.j===e.k||e.f===e.j&&e.g===e.k)){var t=A,s=t(e.i,e.f)+t(e.f,e.c)+t(e.n,e.k)+t(e.k,e.h)+4*t(e.j,e.g),r=t(e.e,e.j)+t(e.j,e.o)+t(e.b,e.g)+t(e.g,e.l)+4*t(e.f,e.k),a=j*s<r;s<r?(e.f!==e.g&&e.f!==e.j&&(m.f=a?L:v),e.k!==e.g&&e.k!==e.j&&(m.k=a?L:v)):r<s&&(e.j!==e.f&&e.j!==e.k&&(m.j=a?L:v),e.g!==e.f&&e.g!==e.k&&(m.g=a?L:v))}}var y,J={getTopL:e=>3&e,getTopR:e=>3&e>>2,getBottomR:e=>3&e>>4,getBottomL:e=>3&e>>6,setTopL:(e,t)=>255&(e|t),setTopR:(e,t)=>255&(e|t<<2),setBottomR:(e,t)=>255&(e|t<<4),setBottomL:(e,t)=>255&(e|t<<6),rotate(e,t){var s=t<<1;return 255&(e<<s|e>>8-s)}};function U(e,t,s,r,a,i,n){var l=s[b[4+t]],h=s[b[8+t]],f=s[b[12+t]],c=s[b[16+t]],o=s[b[20+t]],u=s[b[24+t]],d=s[b[28+t]],p=s[b[32+t]],v=J.rotate(n,t);if(J.getBottomR(v)!==g){var m,w=B,S=C;m=J.getBottomR(v)>=L||!(J.getTopR(v)!==g&&!w(c,u))&&(!(J.getBottomL(v)!==g&&!w(c,h))&&!(w(u,d)&&w(d,p)&&w(p,o)&&w(o,h)&&!w(c,p)));var k=S(c,o)<=S(c,d)?o:d,j=y;if(j.move(t,a),m){var M=S(o,u),A=S(d,h),R=x*A<=M&&c!==h&&l!==h;x*M<=A&&c!==u&&f!==u?R?e.blendLineSteepAndShallow(k,j):e.blendLineShallow(k,j):R?e.blendLineSteep(k,j):e.blendLineDiagonal(k,j)}else e.blendCorner(k,j)}}try{for(var W=Uint8ClampedArray.from(e.data),E=parseInt(e.width),P=parseInt(e.height),q=new Array,z=0,F=W.length;z<F;z+=4){var G=W[z],H=W[z+1],K=W[z+2],N=(V=W[z+3])<<24|G<<16|H<<8|K;q.push(N)}var O=new Array(E*t*P*t);O.fill(0),function(e,t,s,r,a,i,n){if(!((i=Math.max(i,0))>=(n=Math.min(n,a))||r<=0)){var l=r*e,d=[],b={a:0,b:0,c:0,d:0,e:0,f:0,g:0,h:0,i:0,j:0,k:0,l:0,m:0,n:0,o:0,p:0};if(i>0)for(var g=i-1,v=r*Math.max(g-1,0),L=r*g,w=r*Math.min(g+1,a-1),k=r*Math.min(g+2,a-1),j=0;j<r;++j){var M=Math.max(j-1,0),x=Math.min(j+1,r-1),A=Math.min(j+2,r-1);b.a=t[v+M],b.b=t[v+j],b.c=t[v+x],b.d=t[v+A],b.e=t[L+M],b.f=t[L+j],b.g=t[L+x],b.h=t[L+A],b.i=t[w+M],b.j=t[w+j],b.k=t[w+x],b.l=t[w+A],b.m=t[k+M],b.n=t[k+j],b.o=t[k+x],b.p=t[k+A],D(b),d[j]=J.setTopR(d[j],m.j),j+1<r&&(d[j+1]=J.setTopL(255&d[j+1],m.k))}y=new p(e,s,l);var R=0,B=0,C=[];for(g=i;g<n;++g){var I=e*g*l;for(v=r*Math.max(g-1,0),L=r*g,w=r*Math.min(g+1,a-1),k=r*Math.min(g+2,a-1),B=0,j=0;j<r;++j,I+=e){if(M=Math.max(j-1,0),x=Math.min(j+1,r-1),A=Math.min(j+2,r-1),b.a=t[v+M],b.b=t[v+j],b.c=t[v+x],b.d=t[v+A],b.e=t[L+M],b.f=t[L+j],b.g=t[L+x],b.h=t[L+A],b.i=t[w+M],b.j=t[w+j],b.k=t[w+x],b.l=t[w+A],b.m=t[k+M],b.n=t[k+j],b.o=t[k+x],b.p=t[k+A],D(b),R=J.setBottomR(d[j],m.f),B=J.setTopR(B,m.j),d[j]=B,B=J.setTopL(0,m.k),j+1<r&&(d[j+1]=J.setBottomL(d[j+1],m.g)),S(s,I,l,t[L+j],e),0===R)continue;let a;switch(C[0]=t[v+M],C[1]=t[v+j],C[2]=t[v+x],C[3]=t[L+M],C[4]=t[L+j],C[5]=t[L+x],C[6]=t[w+M],C[7]=t[w+j],C[8]=t[w+x],e){case 2:a=new h;break;case 3:a=new f;break;case 4:a=new c;break;case 5:a=new o;break;default:a=new u}U(a,0,C,0,I,0,R),U(a,1,C,0,I,0,R),U(a,2,C,0,I,0,R),U(a,3,C,0,I,0,R)}}}}(t,q,O,E,P,0,P);var Q=new Uint8ClampedArray(4*O.length);for(z=0,F=O.length;z<F;++z){var V=(N=O[z])>>24&255;G=N>>16&255,H=N>>8&255,K=255&N;Q[4*z+0]=G,Q[4*z+1]=H,Q[4*z+2]=K,Q[4*z+3]=V}try{s(new ImageData(Q,E*t,P*t))}catch(Z){var X=document.createElement("canvas");X.width=E*t,X.height=P*t;var Y=X.getContext("2d").createImageData(X.width,X.height);return Y.data.set(Q),Y}s()}catch(Z){r(null)}}))};`
    + "return e;"
)();


window.xbrz = function(image_data) {

    var scale = 6;

    if(Boolean(pool)) {

      return pool.exec(window.xbrz_process_function, [
        image_data,
        scale,
      ]).catch((e) => {

          return window.xbrz_process_function(image_data, scale);

      }).timeout(20 * 1000);

    }else {

        return window.xbrz_process_function(image_data, scale);
    }
};

export default {xbrz: window.xbrz};